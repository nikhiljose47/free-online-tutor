<div class="timetable">
  <div class="subject-card" *ngFor="let sbj of syllabus.subjects | keyvalue">
    <!-- Header -->
    <div class="subject-header">
      <h4>{{ sbj.key }}</h4>
      <span class="code">{{ sbj.value.code }}</span>

      <!-- ðŸ”¥ Current chapter -->
      <div class="current-box" *ngIf="sbj.key === 'Mathematics'; else otherCurrent">
        <small>Current</small>
        <div class="current-name">
          {{ getChapterName('Mathematics', mathCurrentChapter()) }}
        </div>
      </div>

      <ng-template #otherCurrent>
        <div class="current-box" *ngIf="current()[sbj.key] as cur">
          <small>Current</small>
          <div class="current-name">
            {{ getChapterName(sbj.key, cur) }}
          </div>
        </div>
      </ng-template>

      <!-- ðŸ”¥ Upcoming Live for Mathematics -->
      <div class="live-box" *ngIf="sbj.key === 'Mathematics'; else otherLive">
        <h6>Next Live</h6>

        <div class="live-row" *ngFor="let m of mathUpcoming()">
          <span>{{ m.date.toDate() | date : 'shortTime' }} Â· Batch {{ m.batch }}</span>
          <span class="status" [class.live]="true">Upcoming</span>
        </div>

        <div *ngIf="mathUpcoming().length === 0">
          <small>No upcoming classes</small>
        </div>
      </div>

      <!-- Other subjects use existing live() mock -->
      <ng-template #otherLive>
        <div class="live-box" *ngIf="live()[sbj.key] as batches">
          <h6>Next Live</h6>

          <div class="live-row" *ngFor="let b of batches">
            <span>{{ b.time }} Â· Batch {{ b.batch }}</span>
            <span class="status" [class.live]="b.status === 'Live'">{{ b.status }}</span>
          </div>
        </div>
      </ng-template>
    </div>

    <!-- Scrollable chapter list -->
    <div class="chapters">
      <div class="chapter" *ngFor="let ch of sbj.value.chapters">
        <div class="chapter-left">
          <div class="chapter-name">{{ ch.name }}</div>
          <div class="tag" *ngIf="notes()[ch.code]">{{ notes()[ch.code] }}</div>
        </div>

        <div class="chapter-right">
          <span class="chip">{{ ch.code }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

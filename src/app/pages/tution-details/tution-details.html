<div *ngIf="isLoading()">
  <loader text="The classes are loading..."></loader>
</div>

<div *ngIf="!isLoading()">
  <content-placeholder
    *ngIf="!hasValidData()"
    message="This tuition class will be added soon. Check back shortly!"
  ></content-placeholder>

  <div class="details-page" *ngIf="hasValidData()">
    <!-- ================= HEADER + TABS ================= -->
    <header class="page-header d-flex align-items-center justify-content-between">
      <h1 *ngIf="type === 'class'">{{ id }}</h1>
      <h1 *ngIf="type === 'jam'">JAM Session: {{ jamInfo().topic }}</h1>

      <!-- TAB NAV -->
      <nav class="details-tabs">
        <button
          class="tab-btn"
          [class.active]="activeTab() === 'overview'"
          (click)="activeTab.set('overview')"
        >
          Overview
        </button>

        <button
          class="tab-btn"
          [class.active]="activeTab() === 'roadmap'"
          (click)="activeTab.set('roadmap')"
        >
          Roadmap
        </button>

        <button
          class="tab-btn"
          [class.active]="activeTab() === 'upcoming'"
          (click)="activeTab.set('upcoming')"
        >
          Upcoming
        </button>

        <button
          class="tab-btn"
          [class.active]="activeTab() === 'exam'"
          (click)="activeTab.set('exam')"
        >
          Exam Prep
        </button>

        <button
          *ngIf="type === 'class'"
          class="tab-btn"
          [class.active]="activeTab() === 'teachers'"
          (click)="activeTab.set('teachers')"
        >
          Teachers
        </button>

        <button
          *ngIf="type === 'jam'"
          class="tab-btn"
          [class.active]="activeTab() === 'jam'"
          (click)="activeTab.set('jam')"
        >
          Session Info
        </button>
      </nav>
    </header>

    <!-- ================= TAB : OVERVIEW ================= -->
    <section *ngIf="activeTab() === 'overview'" class="section overview-hero">
      <h2 class="section-title">Class Progress Overview</h2>

      <div class="batch-grid">
        <!-- BLUE BATCH -->
        <div class="batch-card batch-blue">
          <div class="batch-header">
            <span class="batch-name">Blue Batch</span>
            <span class="batch-status">In Progress</span>
          </div>

          <div class="batch-progress">
            <div class="batch-progress-fill" style="width: 45%"></div>
          </div>

          <div class="batch-percent">45% completed</div>

          <div class="batch-roadmap">
            <div class="roadmap-item">
              <span>Mathematics</span>
              <span>5 / 12 chapters</span>
            </div>
            <div class="roadmap-item">
              <span>Science</span>
              <span>3 / 10 chapters</span>
            </div>
          </div>

          <div class="batch-hint">Progress is calculated subject-wise</div>
        </div>

        <!-- YELLOW BATCH -->
        <div class="batch-card batch-yellow">
          <div class="batch-header">
            <span class="batch-name">Yellow Batch</span>
            <span class="batch-status">Yet to begin</span>
          </div>

          <div class="batch-hint">This batch has not started yet.</div>
        </div>
      </div>
    </section>

    <!-- ================= TAB : ROADMAP ================= -->
    <section *ngIf="activeTab() === 'roadmap'" class="section">
      <h2 class="section-title">Detailed Roadmap</h2>
      <timetable></timetable>
    </section>

    <!-- ================= TAB : UPCOMING ================= -->
    <section *ngIf="activeTab() === 'upcoming'" class="section">
      <h2 class="section-title">Upcoming Classes</h2>

      <div class="upcoming-grid" *ngIf="upcomingClasses()?.length">
        <div class="upcoming-card" *ngFor="let cls of upcomingClasses()" (click)="openClass(cls)">
          <div class="upcoming-header">
            <h3 class="upcoming-title">{{ cls.title }}</h3>
            <span class="upcoming-subject">{{ cls.subject }}</span>
          </div>

          <div class="upcoming-meta">
            <span>‚è± {{ cls.duration }} mins</span>
            <span>üë• {{ cls.interested }} interested</span>
            <span>üìÖ {{ cls.startsAt | date: 'mediumDate' }}</span>
          </div>

          <div class="upcoming-action">
            <button
              class="btn btn-outline-primary btn-sm"
              (click)="markInterested(cls); $event.stopPropagation()"
            >
              I'm Interested
            </button>
          </div>
        </div>
      </div>

      <content-placeholder
        *ngIf="!upcomingClasses()?.length"
        message="No upcoming classes scheduled yet."
      ></content-placeholder>
    </section>

    <!-- ================= TAB : EXAM PREP ================= -->
    <section *ngIf="activeTab() === 'exam'" class="section">
      <h2 class="section-title">Exam Preparation</h2>

      <div class="prep-list">
        <div class="prep-item" *ngFor="let p of examPrep()">
          <h3>{{ p.title }}</h3>
          <span class="badge">{{ p.level }}</span>
        </div>
      </div>
    </section>

    <!-- ================= TAB : TEACHERS ================= -->
    <section *ngIf="activeTab() === 'teachers'" class="section">
      <h2 class="section-title">Teachers</h2>

      <div class="teachers">
        <div class="teacher-card" *ngFor="let t of teachers()">
          <img [src]="t.avatar" class="avatar" />
          <div class="info">
            <h4>{{ t.name }}</h4>
            <p>{{ t.subject }}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ================= TAB : JAM INFO ================= -->
    <section *ngIf="activeTab() === 'jam'" class="section">
      <h2 class="section-title">Session Details</h2>

      <div class="jam-box">
        <p><b>Host:</b> {{ jamInfo().host }}</p>
        <p><b>Topic:</b> {{ jamInfo().topic }}</p>
        <p><b>Starts at:</b> {{ jamInfo().starts }}</p>
        <p><b>Participants:</b> {{ jamInfo().participants }}</p>
      </div>
    </section>

    <!-- ================= QUOTE ================= -->
    <section class="quote-section">
      <p class="quote-text">‚Äú{{ quote() }}‚Äù</p>
    </section>
  </div>
</div>

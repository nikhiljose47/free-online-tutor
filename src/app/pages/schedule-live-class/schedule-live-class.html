<div class="container py-4">
  <!-- Header -->
  <div class="d-flex align-items-center mb-3">
    <h4 class="fw-bold mb-0 flex-grow-1">{{ profile()?.name }}’s Classes</h4>
  </div>

  <!-- Horizontal Rail (always visible) -->
  <div class="meetings-rail-wrapper mb-4">
    <!-- Right Arrow (only if meetings exist) -->
    <button
      *ngIf="meetings().length"
      class="rail-arrow"
      type="button"
      (click)="rail.scrollBy({ left: 260, behavior: 'smooth' })"
    >
      →
    </button>

    <!-- Scrollable strip -->
    <div #rail class="meetings-strip">
      <!-- ✅ SCHEDULE CARD (always visible) -->
      <div
        class="meeting-card schedule-card"
        (click)="startCreate()"
        [class.active]="mode() === 'create'"
      >
        <div class="schedule-plus">＋</div>
        <div class="schedule-text">Schedule<br />Class</div>
      </div>

      <!-- EXISTING MEETINGS (only if any) -->
      <div
        class="meeting-card"
        *ngFor="let m of meetings(); trackBy: trackByMeetingId"
        [class.live]="m.status === 'LIVE'"
        [class.active]="mode() === 'view' && selectedMeeting()?.id === m.id"
        (click)="selectMeeting(m)"
      >
        <!-- TOP -->
        <div class="card-top">
          <div class="class-id">Class {{ m.classId }}</div>
          <div class="subject">{{ m.subjectId }}</div>
        </div>

        <!-- BOTTOM -->
        <div class="card-bottom">
          <span class="time">
            {{ m.date.toDate() | date : 'hh:mm a, MMM d' }}
          </span>

          <span *ngIf="m.status === 'LIVE'" class="live-pill"> LIVE </span>
        </div>
      </div>
    </div>
  </div>

  <!-- VIEW MODE -->
  <div *ngIf="mode() === 'view' && selectedMeeting()" class="details-card mx-auto">
    <class-wrapup [meetId]="selectedMeeting()?.id ?? ''"></class-wrapup>
  </div>

  <!-- CREATE MODE -->
  <div *ngIf="mode() === 'create'" class="details-card mx-auto">
    <h6 class="fw-bold mb-3">Schedule New Class</h6>

    <div class="row g-3">
      <!-- CLASS -->
      <div class="col-md-6">
        <select class="form-select" #classSel (change)="updateField('classId', classSel.value)">
          <option value="">Class</option>
          <option *ngFor="let c of classList()" [value]="c">
            {{ c }}
          </option>
        </select>
      </div>

      <!-- SUBJECT -->
      <div class="col-md-6">
        <select
          class="form-select"
          #subjectSel
          (change)="updateField('subjectId', subjectSel.value)"
        >
          <option value="">Subject</option>
          <option *ngFor="let s of subjectList()" [value]="s">
            {{ s }}
          </option>
        </select>
      </div>

      <!-- CHAPTER -->
      <div class="col-md-12">
        <select
          class="form-select"
          #chapterSel
          (change)="updateField('chapterCode', chapterSel.value)"
        >
          <option value="">Chapter</option>
          <option *ngFor="let ch of chapterList()" [value]="ch.code">
            {{ ch.code }} — {{ ch.name }}
          </option>
        </select>
      </div>

      <!-- BATCH -->
      <div class="col-md-6">
        <input
          class="form-control"
          placeholder="Batch ID"
          #batchInput
          (input)="updateField('batchId', batchInput.value)"
        />
      </div>

      <!-- MEET LINK -->
      <div class="col-md-6">
        <input
          class="form-control"
          placeholder="Meeting Link"
          #meetInput
          (input)="updateField('meetLink', meetInput.value)"
        />
      </div>

      <!-- DATE -->
      <div class="col-md-12">
        <input
          type="datetime-local"
          class="form-control"
          #dateInput
          (change)="updateField('date', dateInput.value)"
        />
      </div>

      <!-- ACTION -->
      <div class="col-12 text-end">
        <button
          class="btn btn-primary btn-sm px-4"
          [disabled]="submitting()"
          (click)="scheduleClass()"
        >
          Schedule
        </button>
      </div>
    </div>
  </div>
</div>
